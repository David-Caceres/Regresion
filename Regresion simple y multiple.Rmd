---
title: "Ejercicios_Regresión_simple_multiple"
author: "David Cáceres"
date: "11/4/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#### 1. (Ejercicio 6.8 del Capítulo 6 página 118)

#### Hallar la recta de regresión simple de la variable respuesta raíz cuadrada de la velocidad sobre la variable regresora densidad con los datos de la tabla 1.1 del capítulo 1.


```{r}
require(faraway)

dens <- c(12.7,17.0,66.0,50.0,87.8,81.4,75.6,66.2,81.1,62.8,77.0,89.6,
           18.3,19.1,16.5,22.2,18.6,66.0,60.3,56.0,66.3,61.7,66.6,67.8)
vel <- c(62.4,50.7,17.1,25.9,12.4,13.4,13.7,17.9,13.8,17.9,15.8,12.6,
          51.2,50.8,54.7,46.5,46.3,16.9,19.8,21.2,18.3,18.0,16.6,18.3)
rvel <- sqrt(vel)
lmod1<-lm(rvel ~ dens)
summary(lmod1)

```
#### (i) La suma de los residuos es cero

```{r}

residuos<- residuals(lmod1)
sum(residuos)

# El valor es prácticamente cero por redondeo

```


#### (ii) Pyi = Pyˆi

```{r}

sum(rvel)

sum(fitted(lmod1))

```

#### (iii) La suma de los residuos ponderada por los valores de la variable regresora es cero:

```{r}
sum(residuos*dens)
```


#### (iv) La suma de los residuos ponderada por las predicciones de los valores observados es cero:

```{r}
sum(fitted(lmod1)*residuos)
```


#### Calcular la estimación de σ² y, a partir de ella, las estimaciones de las desviaciones estándar de los estimadores de los parámetros βˆ0 y βˆ1.

```{r}
length<-length(dens)
SCRlmod1<-sum(residuos^2)
sigma<-SCRlmod1/(length-2)
sigma
```


```{r}
s2dens<-(1/length)*sum((dens-mean(dens))^2)
Sdens<-length*s2dens
ebeta1lmod1<-sqrt(sigma*((1/length)+(mean(dens)^2/Sdens)))
```

```{r}
ebeta0lmod1<-sqrt(sigma*((1/length)+(mean(dens)^2/Sdens)))
ebeta0lmod1
```


#### Escribir los intervalos de confianza para los parámetros con un nivel de confianza del 95 %.

```{r}

tlmod1 <- qt(0.975,lmod1$df)
# Para Beta1
lmod1$coef[2]+c(-1,1)*tlmod1*ebeta1lmod1

# Para beta0
lmod1$coef[1]+c(-1,1)*tlmod1*ebeta0lmod1
```

#### Construir la tabla para la significación de la regresión y realizar dicho contraste. (H0: ß1=0 (No hay efecto de la relación entre ambas variables)


```{r}
summary(aov(lmod1))
```


Significativo a p<<alfa=0.005


#### Hallar el intervalo de la predicción de la respuesta media cuando la densidades de 50 vehículos por km. Nivel de confianza: 90 %


```{r}
y0 <- lmod1$coef[1]+lmod1$coef[2]*50

y0

tlmod1 <- qt(0.950,lmod1$df)
sigma <- sqrt(sigma)
y0+c(-1,1)*tlmod1*sigma*sqrt(1+(1/length)+((((50-mean(dens))^2)/Sdens)))

predict(lmod1,new=data.frame(dens=50),interval="prediction",level=0.90)

 predict(lmod1,new=data.frame(dens=50),interval="confidence",level=0.90)
```



### 3. (Ejercicio 6.10 del Capítulo 6 página 118)
####Se admite que una persona es proporcionada si su altura en cm es igual a su peso en kg más 100. En términos estadísticos si la recta de regresión de Y (altura) sobre X (peso) es:

Y = 100 + X


#### Contrastar, con un nivel de significación α = 0.05, si se puede considerar válida esta hipótesis a partir de los siguientes datos que corresponden a una muestra de mujeres jóvenes:

```{r}
x <- c(55,52,65,54,46,60,54,52,56,65,52,53,60)
y <- c(164,164,173,163,157,168,171,158,169,172,168,160,172)
```


#### Razonar la bondad de la regresión y todos los detalles del contraste.

```{r}
lmod2<-lm(y  ~ x)
summary(lmod2)

```


```{r}
plot(y~x, xlim=c(40,75), ylim=c(140, 180))
abline(lmod2)
abline(100,1)
```


```{r}
confint(lmod2)

```


```{r}
modelo0<-lm(y ~ 0 + offset(100 + x))
anova(modelo0, lmod2)
```

Rechazamos la hipótesis nula



#### 4. (Ejercicio 6.11 del Capítulo 6 página 119)


El período de oscilación de un péndulo es 2π| l/g
donde l es la longitud y g es la constante de
gravitación. En un experimento observamos t ij (j = 1, . . . , n i ) períodos correspondientes a l i (i =
1, . . . , k) longitudes.

#### (a) Proponer un modelo, con las hipótesis que se necesiten, para estimar la constante método de los mínimos cuadrados.


```{r}
longitud<- c(rep(18.3,4),rep(20,2),rep(21.5,3),rep(15,2))
x<-sqrt(longitud)
y<-c(8.58,7.9,8.2,7.8,8.4,9.2,9.7,8.95,9.2,7.5,8)
lmod3<-lm(y ~ 0 + sqrt(x))
summary(lmod3)
```

#### (b) Contrastar H0:2πg√

```{r}
# Miramos si el intervalo de confianza contiene el 2

confint(lmod3)
```

No lo contiene así que rechazamos la hipótesis nula



#### 5. (Ejercicio 8.4 del Capítulo 8 página 157)
Se dispone de los siguientes datos sobre diez empresas fabricantes de productos de limpieza doméstica:

```{r}
# Datos

v <- c(60,48,42,36,78,36,72,42,54,90)
ip <- c(100,110,130,100,80,80,90,120,120,90)
pu <- c(1.8,2.4,3.6,0.6,1.8,0.6,3.6,1.2,2.4,4.2)
```

```{r}
lmod4<-lm(v ~ ip +pu)
summary(lmod4)
```


#### 1) Estimar el vector de coeficientes β = (β 0 , β 1 , β 2 ) 0 del modelo

```{r}
lmod4$coefficients
```

#### 2) Estimar la matriz de varianzas-covarianzas del vector β.


```{r}
summary(lmod4)$sigma^2 * summary(lmod4)$cov.unscaled
```


#### 3) Calcular el coeficiente de determinación.

```{r}
sum4<-summary(lmod4)
names(sum4)
sum4$r.squared
```


## Ejercicios del libro de Faraway

#### 1. (Ejercicio 1 cap. 4 pág. 56)
For the prostate data, fit a model with lpsa as the response and the other variables as predictors:

```{r}
require(faraway)
data(prostate)
```

```{r}
lmod5<- lm(lpsa~lcavol + lweight + age + lbph + svi +lcp+ gleason+pgg45, data = prostate)
summary(lmod5)
```


#### (a) Suppose a new patient with the following values arrives:

Predict the lpsa for this patient along with an appropriate 95% CI.


```{r}
head(x0pros <- data.frame(lcavol=1.44692,
                                              lweight=3.62301,
                                              age=65,
                                              lbph=0.30010,
                                              svi=0,
                                              lcp=-0.79851,
                                              gleason=7,
                                              pgg45=15))


```



```{r}
predict(lmod5, x0pros, interval="prediction", level=0.95)
```

#### (b) Repeat the last question for a patient with the same values except that he is age 20. Explain why the CI is wider.

```{r}
x1pros <- data.frame(lcavol=1.44692,lweight=3.62301,age=20,lbph=0.30010,svi=0,lcp=-0.79851,gleason=7,pgg45=15)
predict(lmod5,x1pros,interval="prediction")
```

E el apartado B, el valor para la edad, está fuera del rango de los valores del dataset, por eso el intervalo de confianza es mayor.

#### (c) For the model of the previous question, remove all the predictors that are not significant at the 5% level. Now recompute the predictions of the previous question. Are the CIs wider or narrower? Which predictions would you prefer? Explain.
```{r}
 summary(lmod5)
```

Las variables con significación al 5% son "lcavol", "lweight", "svi". Creamos un nuevo modelo con ellas.

```{r}
lmod6<-lm(lpsa ~ lcavol + lweight + svi, data=prostate)
summary(lmod6)
```


```{r}
predict(lmod6, x0pros, interval="prediction")

predict(lmod6, x1pros, interval="prediction")
```


#### 2. (Ejercicio 2 cap. 4 pág. 57)
Using the teengamb data, fit a model with gamble as the response and the other variables as predictors.

```{r}
data(teengamb)
lmod7<-lm(gamble ~ sex + status + income +verbal, data=teengamb)
summary(lmod7)
```

#### (a) Predict the amount that a male with average (given these data) status, income and verbal score would gamble along with an appropriate 95% CI.

```{r}

attach(teengamb)
x0gamb<-data.frame( sex=0, status=median(status), 
                                  income=median(income), verbal=median(verbal))

predict(lmod7,x0gamb,interval="prediction")
```


#### (b) Repeat the prediction for a male with maximal values (for this data) of status, income and verbal score. Which CI is wider and why is this result expected?

```{r}
x1gamb <- data.frame(sex=0, status=max(status),
                                            income=max(income),verbal=max(verbal))

predict(lmod7,x1gamb,interval="prediction")
```


#### (c) Fit a model with sqrt(gamble) as the response but with the same predictors. Now predict the response and give a 95% prediction interval for the individual in (a). Take care to give your answer in the original units of the response.

```{r}
lmod8<-lm(sqrt(gamble) ~ sex + status + income +verbal, data=teengamb)
predict(lmod8,x0gamb,interval="prediction")
```

```{r}
predict(lmod8,x0gamb,interval="prediction")^2
```


#### (d) Repeat the prediction for the model in (c) for a female with status = 20, income = 1, verbal = 10. Comment on the credibility of the result

```{r}
x2gamb <- data.frame(sex=1,status=20,income=1,verbal=10)
 predict(lmod8,x2gamb,interval="prediction")^2
```



## 3. (Ejercicio 3 cap. 4 pág. 57)
The snail dataset contains percentage water content of the tissues of snails grown under three different levels of relative humidity and two different temperatures.